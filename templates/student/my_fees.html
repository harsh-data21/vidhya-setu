{% extends 'layouts/dashboard_base.html' %}

{% block title %}My Fees | Vidhya Setu ERP{% endblock %}

{% block dashboard_content %}

<h2 style="margin-top:0;">My Fees</h2>
<hr>

<!-- ================= SUMMARY ================= -->
<div style="margin-bottom:20px;">
    <strong>Total Fees:</strong> ₹{{ total_amount|default:"0.00" }} <br>
    <strong>Paid:</strong> ₹{{ paid_amount|default:"0.00" }} <br>
    <strong>Pending:</strong> ₹{{ pending_amount|default:"0.00" }}
</div>

<!-- ================= FEES TABLE ================= -->
<table border="1" cellpadding="10" cellspacing="0" width="100%">
    <thead>
        <tr style="background:#f3f4f6;">
            <th>Class</th>
            <th>Month</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Paid On</th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
    {% for fee in fees %}
        <tr>
            <td>{{ fee.fee_structure.class_name }}</td>
            <td>{{ fee.fee_structure.month }}</td>
            <td>₹{{ fee.fee_structure.amount }}</td>

            {% if fee.status == 'PAID' %}
                <td style="color:green;"><strong>PAID</strong></td>
                <td>{{ fee.paid_on|date:"d M Y" }}</td>
                <td>
                    <a href="{% url 'fee_receipt' fee.id %}">
                        Download Receipt
                    </a>
                </td>
            {% else %}
                <td style="color:red;"><strong>PENDING</strong></td>
                <td>—</td>
                <td>
                    <form method="post" action="{% url 'pay_fee' fee.id %}">
                        {% csrf_token %}
                        <button type="submit">
                            Pay Now
                        </button>
                    </form>
                </td>
            {% endif %}
        </tr>
    {% empty %}
        <tr>
            <td colspan="6" style="text-align:center;">
                No fee records found.
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}
